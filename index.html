<!DOCTYPE html>
<html lang="en">

<header>
    <script type="text/javascript" src="jquery-3.6.4.js"> </script>
    <script type="text/javascript" src="imageLoops.js"></script>
</header>

<body>
    

    <canvas id = "canvas" style="">
    </canvas>

    <script>

//in penguins file, use the created json file (animation.json)
//the file is massive and will not load before the first call_me_on_dram() function is called
//to get around this issue, we use asynchronous calls


        //var imageLoops;
        $.getJSON('imageLoops.json', function(data) {
            imageLoops = data;
            //window.alert("data is ready");
            is_my_data_ready = true;
            //function loads json map data as a var
        });

        //declare a class called sprite, sprite has a heading, x, y
        class Sprite{
            constructor(){
                this.x = 0;
                this.y = 0;
                heading = 'idle';
            }
            //init(){
            //    heading = 'idle';
            //    this.x = 0;
            //    this.y = 0;
            //}
        }


        class ImageLoops{
            constructor(size, animation, name){
                for(int i = 0; i < size; i++){
                    
            }
        }
        let canvas = document.getElementById("canvas");

        var init_size = true;
        window.addEventListener("resize", resizeCanvas, false)

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (init_size) {
                init_size = false;
                return;
            }
            for (var i = 0; i < agents.length; i++) {
                agents[i].canvas_resize();
            }
        }
        resizeCanvas();


        function readImgsFromJson() {

        }

        var is_my_data_ready = false;
        var heading = 'Idle';
        var img = new Image();
        //img.src = "0.png";
        //img.src = imageLoops[heading]['0']["Img"];
        //console.log(img.src);
        //console.log("got it" + imageLoops['East']);
        //console.log(imageLoops);

        var context = canvas.getContext("2d");
        var x = 10;
        var x_dist = 10;
        var y = 10;
        var y_dist = 50;
        var last_animation_time = new Date().getTime();
        var time_delta = 50;
        var bk_img = null;

        function call_me_on_draw() {
            //window.requestAnimationFrame(call_me_on_draw);

            if(is_my_data_ready == false){
                return;
            }
            img.src = imageLoops[heading]['0']["Img"];

            if ((time_delta + last_animation_time) > new Date().getTime()) {

                return;

            }

            last_animation_time = new Date().getTime();

            if (bk_img != null) {

                context.putImageData(bk_img, x, y);

            }

            if (x > window.innerWidth) {

                x = 10;

                y = y + y_dist;

            }

            x = x + x_dist;

            bk_img = context.getImageData(x, y, 134, 142);

            if(y > window.innerHeight)
            {
                y = 10;

                x = x + x_dist;
            }

            //loop_index++;

            //if (loop_index > 3) {

                //loop_index = 0;

            //}

            //img = loop_imgs[loop_index];

            context.drawImage(img, x, y, 134, 142);


            //this context.drawImage(this.current_image. this.cur_x this.cur_y, this.current_image width*this.canvas)

        }


        call_me_on_draw();




        document.onkeydown = function(e) {
            console.log(e.which);
            switch(e.which) {
                case 37: // left
                heading = 'East';
                //WALK EAST ANIMATION
                break;
        
                case 38: // up
                heading = 'North';
                //WALK NORTH ANIMATION
                break;
        
                case 39: // right
                heading = 'WEST';
                //WALK WEST ANIMATION
                break;

                case 40: // down
                heading = 'South';
                //WALK SOUTH ANIMATION
                break;
        
                default: heading = 'Idle'; // Idle for all other key types
            }
            e.preventDefault(); // prevent the default action (scroll / move caret)

        };



    </script>
</body>

</html>